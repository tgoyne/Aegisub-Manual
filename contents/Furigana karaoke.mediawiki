[[Image:Furigana-demo-1.png|frame|right|Sample of basic furigana karaoke]]

''Furigana'' (in Aegisub often shortened to ''furi'') refers to little phonetic guide characters written along the main text in Japanese, specifically using the hiragana phonetic alphabet to describe how the ideographic kanji characters should be pronounced. Putting smaller text next to a main line of text is in general referred to as [http://en.wikipedia.org/wiki/Ruby_character ''ruby text''], but since the implementation discussed here is designed specifically with Japanese furigana in mind, the ruby text is also referred to as furigana everywhere.

None of the subtitle formats Aegisub supports, natively support ruby text or furigana, however the [[Automation 4 karaskel.lua]] standard include implements an algorithm that can create basic furigana layouts by calculating the position of every individual character.

This page describes the syntax the Automation 4 karaskel.lua script understands for furigana text, and how to use the layout information it calculates to actually create positioned characters.

[[Karaoke Templater]] also implements support for furigana using the karaskel.lua algorithm and syntax.

It's important to note that the syntax is designed for karaoke, and revolves around [[Karaoke timing|karaoke timed]] text.

== Multi-highlight syntax ==

A prerequisite for an integral part of the furigana syntax is the multi-highlight syntax.

If you make the text of a syllable a number sign (#, ASCII 35, Unicode U+0023) that syllable will "join" with the previous one: The number sign is removed and the timing of the two syllables are added together, producing just one syllable. You can have multiple number sign syllables in a row, adding up multiple timings in that way.

The timings of the individual number sign syllables are still stored in the [[Automation 4 karaskel.lua#Highlight table|highlight table]] of the generated syllable structure, but the main timing (<code>start_time</code> and <code>end_time</code>) of the syllable structure reflects only the added-together timings of the number sign syllables.

{{Examplebox|1=
This line shows how multi-highlight syntax is used to mark up kanji and groups of kanji that cover multiple syllables:

 {\k5}明日<u>{\k10}#{\k5}#</u>{\k10}ま{\k7}だ{\k10}会{\k4}う{\k6}時<u>{\k14}#</u>

It generates the following syllable structures:

<table border="1" cellpadding="3" cellspacing="0" style="border:gray solid 1px; border-collapse:collapse; text-align:left;">
<tr><th>Text</th><th>Syllable duration</th><th>Highlight durations</th></tr>
<tr><td rowspan="3">明日</td><td rowspan="3">20</td><td>5</td></tr>
<tr><td>10</td></tr>
<tr><td>5</td></tr>
<tr><td>ま</td><td>10</td><td>10</td></tr>
<tr><td>だ</td><td>7</td><td>7</td></tr>
<tr><td>会</td><td>10</td><td>10</td></tr>
<tr><td>う</td><td>4</td><td>4</td></tr>
<tr><td rowspan="2">時</td><td rowspan="2">20</td><td>6</td></tr>
<tr><td>14</td></tr>
</table>
}}

== Basic furigana ==

{{todo|you add furigana by putting a pipe and the furi at the end of a syllable}}

== Controlling the layout ==

{{todo|layout is usually automatic and takes some guesses, but when two separate furi'ed sequences touch, or when they just get too close, you might need to control the layout}}

== Examples ==
{{Examplebox|
Here's a quick sample for kara-templater that does furigana.
Try it out with Default being MS PGothic size 30.

<pre>Comment: 0,0:00:00.00,0:00:00.00,Default,,0000,0000,0000,template syl,{\pos(!line.left+syl.center!,!line.middle!)\an5\k!syl.start_time/10!\k$kdur}
Comment: 0,0:00:00.00,0:00:00.00,Default,,0000,0000,0000,template furi,{\pos(!line.left+syl.center!,!line.middle-line.height!)\an5\k!syl.start_time/10!\k$kdur}
Comment: 0,0:00:00.00,0:00:02.00,Default,,0000,0000,0000,karaoke,{\k15}二|ふ{\k15}#|た{\k10}人|り{\k15}だ{\k57}け{\k5}の{\k6}地|ほ{\k5}球|し{\k8}で
Comment: 0,0:00:02.00,0:00:04.00,Default,,0000,0000,0000,karaoke,{\k10}中|ちゅ{\k10}#|う{\k10}国|ご{\k10}#|く{\k10}魂|<た{\k10}#|ま{\k10}#|し{\k10}#|い
Comment: 0,0:00:04.00,0:00:06.00,Default,,0000,0000,0000,karaoke,{\k10}中|ちゅ{\k10}#|う{\k10}国|ご{\k10}#|く{\k10}魂|!た{\k10}#|ま{\k10}#|し{\k10}#|い</pre>

Using MS PGothic 30 pt, 15 pt for the furigana, the three lines render like this:

[[Image:Furigana-demo-1.png]]

[[Image:Furigana-demo-2.png]]

[[Image:Furigana-demo-3.png]]
}}